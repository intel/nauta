# Batch prediction with files in TFRecords format

By default batch prediction functionality provided by dls4e system uses files in the protocolbuffer format as a  
source of data used in prediction. The system however has also option allowing users to pass data in TFRecords
format. To make the system accept this format, the following things have to be done:
1) a user must prepare a file in TFRecords format according to the following rules:  
a) each item to be predicted should contain data in protocolbuffer format - this data should be put into
the TFRecords data as _data_pb_ feature
b) if there is such need - a user can add label to each item as a _label_ feature. Value of this feature
should be _utf_8_ encoded. 
2) batch prediction session should be run with -tf/--tf_record option - -d/--data parameter should point out
the file in TFRecords format

Results of a batch prediction session that uses TFRecords format are files with results - one file for each
input TFRecords file. An output file is a serialized (using Python pickle package) list of dictionary item where
each item contains two keys:
- label - containing label describing the result. If label was passed in TFRecord file - this label is stored here. 
If there was no label - ouptut label is created as a concatenation of an input filename (without extension) and
a consecutive number of a current item.
- data - output in protocolbuffer format
Name of an output filename is an input filename (without extension) extended with _.result_ extension. 

Example code that converts files in protocolbuffer format to TFRecords is can be found in tfrecords_converter.py file. 
This code converts all files from a folder given as a _--input_dir_ folder to one file in TFRecords format. Converter
uses filenames as labels. File generated by this script is saved to _--output_file_ location.